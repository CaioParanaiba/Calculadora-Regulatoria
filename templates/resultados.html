<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js -->
    <style>
        body {
            background-color: #f9fafb;
            font-family: 'Arial', sans-serif;
        }
        .container {
            margin-top: 50px;
            max-width: 1200px;
        }
        .card {
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border-radius: 10px;
        }
        .card-header {
            background-color: #007bff;
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding: 15px;
        }
        .table {
            margin-bottom: 0;
        }
        .table th {
            background-color: #e9ecef;
            text-align: center;
            font-weight: bold;
        }
        .table td {
            vertical-align: middle;
            text-align: center;
        }
        .total-row {
            background-color: #f1f1f1;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .chart-container {
            max-width: 500px;
            margin: auto;
        }
        .btn-back {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                Resultados para {{ empresa.name }}
            </div>
            <div class="card-body row">
                <!-- Tabela -->
                <div class="col-md-6">
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle">
                            <thead>
                                <tr>
                                    <th>Subcategoria</th>
                                    <th>Descrição</th>
                                    <th>Valor Calculado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for resultado in resultados %}
                                <tr>
                                    <td>{{ resultado.subcategoria }}</td>
                                    <td>{{ resultado.descricao }}</td>
                                    <td>R$ {{ "%.2f"|format(resultado.valor_calculado) }}</td>
                                </tr>
                                {% endfor %}
                                <!-- Linha para o total -->
                                <tr class="total-row">
                                    <td colspan="2">Total:</td>
                                    <td>R$ {{ "%.2f"|format(total_calculado) }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Gráfico -->
                <div class="col-md-6 chart-container">
                    <canvas id="resultadosChart"></canvas>
                </div>
            </div>
            <!-- Botão de voltar -->
            <div class="text-center btn-back">
                <a href="{{ url_for('home.home') }}" class="btn btn-primary">
                    Voltar para início
                </a>
            </div>
        </div>
    </div>

    <!-- Gráfico com Chart.js -->
    <script>
        // Paleta de 19 cores
        const colors = [
            '#ff6384', '#36a2eb', '#ffcd56', '#4bc0c0', '#9966ff',
            '#ff9f40', '#e91e63', '#03a9f4', '#8bc34a', '#ff5722',
            '#607d8b', '#795548', '#009688', '#cddc39', '#ffc107',
            '#3f51b5', '#9c27b0', '#f44336', '#2196f3'
        ];

        // Dados para o gráfico
        const data = {
            labels: [{% for resultado in resultados %}"{{ resultado.subcategoria }}"{% if not loop.last %}, {% endif %}{% endfor %}],
            datasets: [{
                label: 'Valores Calculados',
                data: [{% for resultado in resultados %}{{ resultado.valor_calculado }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: colors,
                hoverOffset: 4
            }]
        };

        // Configuração do gráfico
        const config = {
            type: 'pie',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Distribuição dos Valores Calculados'
                    }
                }
            }
        };

        // Renderizar o gráfico
        const resultadosChart = new Chart(
            document.getElementById('resultadosChart'),
            config
        );
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
